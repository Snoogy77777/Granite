#version 450
#extension GL_EXT_mesh_shader : require
#extension GL_KHR_shader_subgroup_basic : require
#extension GL_KHR_shader_subgroup_ballot : require
layout(max_primitives = 1, max_vertices = 3, triangles) out;
layout(local_size_x = 3) in;

layout(location = 0) perprimitiveEXT out vec4 vColor[];

void main()
{
    SetMeshOutputsEXT(3, 1);

    if (gl_LocalInvocationIndex < 3)
    {
        vColor[gl_LocalInvocationIndex] = vec4(1.0, 0.0, 1.0, 1.0);
        vec4 pos;
        pos.x = float(gl_LocalInvocationIndex & 2) * 1.0 - 3.0;
        pos.y = float(gl_LocalInvocationIndex & 1) * 2.0 - 3.0;
        pos.xy += vec2(gl_WorkGroupID.xy) * 2.0;
        pos.z = 0.0;
        pos.w = 4.0;
        gl_MeshVerticesEXT[gl_LocalInvocationIndex].gl_Position = pos;
    }

    if (gl_LocalInvocationIndex < 1)
        gl_PrimitiveTriangleIndicesEXT[gl_LocalInvocationIndex] = uvec3(0, 1, 2);
}